<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CityConnect | Report Issue</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-slate-50 text-slate-700">

<!-- ================= NAVBAR ================= -->
<nav class="bg-white border-b border-slate-200 px-8 py-4 flex items-center">
  <div class="flex items-center gap-2">
    <div class="bg-blue-600 p-2 rounded-full">
      <i class="fa-solid fa-city text-white text-xs"></i>
    </div>
    <span class="font-bold text-xl">CityConnect</span>
  </div>

  <div class="ml-10 hidden md:flex gap-8 text-sm font-medium text-slate-500">
    <a href="#">Dashboard</a>
    <a href="#" class="text-blue-600 border-b-2 border-blue-600 pb-1">Report Issue</a>
    <a href="#">Live Map</a>
  </div>
</nav>

<!-- ================= MAIN ================= -->
<main class="max-w-6xl mx-auto py-12 px-4">

  <h1 class="text-4xl font-extrabold text-slate-900 text-center mb-2">
    Report an Infrastructure Issue
  </h1>
  <p class="text-center text-slate-500 mb-10">
    Help improve your city by reporting problems instantly
  </p>

  <div class="bg-white rounded-3xl shadow-xl flex flex-col md:flex-row overflow-hidden">

    <!-- LEFT : IMAGE -->
    <div class="md:w-5/12 p-10 bg-slate-50 border-r">
      <h2 class="font-bold mb-4">üì∑ Upload Evidence</h2>

      <div class="border-2 border-dashed rounded-xl p-10 text-center relative">
        <input type="file" id="image" accept="image/*"
          class="absolute inset-0 opacity-0 cursor-pointer">

        <p class="font-bold">Upload Photo</p>
        <p class="text-xs text-slate-400 mb-4">Click to select image</p>

        <img id="preview" class="hidden rounded-xl w-full object-cover mt-4">
      </div>

      <div id="statusBox" class="hidden mt-6 p-4 border rounded-xl">
        <b>AI Status</b>
        <div id="response" class="text-xs mt-2"></div>
      </div>
    </div>

    <!-- RIGHT : FORM -->
    <div class="md:w-7/12 p-10">
      <h2 class="font-bold mb-6">üìç Location & Details</h2>

      <form id="issueForm" class="space-y-4">

        <!-- LATITUDE (backend ke liye hidden) -->
        <input type="hidden" id="latitude" value="12.9716">

        <!-- PINCODE -->
        <div>
          <label class="text-xs font-bold uppercase text-slate-500">Pincode</label>
          <input type="text" id="pincode" placeholder="Enter pincode"
            class="w-full px-4 py-2 border rounded-lg">
        </div>

        <!-- STREET -->
        <div>
          <label class="text-xs font-bold uppercase text-slate-500">Street</label>
          <input type="text" id="street"
            class="w-full px-4 py-2 border rounded-lg">
        </div>

        <!-- WARD -->
        <div>
          <label class="text-xs font-bold uppercase text-slate-500">Ward</label>
          <select id="ward" class="w-full px-4 py-2 border rounded-lg">
            <option>Ward 01</option>
            <option>Ward 02</option>
          </select>
        </div>

        <!-- PRIORITY -->
        <div>
          <label class="text-xs font-bold uppercase text-slate-500">Priority</label>
          <select id="priority" class="w-full px-4 py-2 border rounded-lg">
            <option value="LOW">Low</option>
            <option value="MEDIUM">Medium</option>
            <option value="HIGH">High</option>
          </select>
        </div>

        <button type="submit"
          class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700">
          üöÄ Submit Report
        </button>
      </form>
    </div>
  </div>
</main>

<!-- ================= JS ================= -->
<script>
const imageInput = document.getElementById("image");
const preview = document.getElementById("preview");
const statusBox = document.getElementById("statusBox");
const responseDiv = document.getElementById("response");

imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = e => {
    preview.src = e.target.result;
    preview.classList.remove("hidden");
    statusBox.classList.remove("hidden");
    responseDiv.innerText = "Image selected. Ready to upload.";
  };
  reader.readAsDataURL(file);
});

document.getElementById("issueForm").addEventListener("submit", async e => {
  e.preventDefault();

  responseDiv.innerText = "Uploading & analyzing...";
  statusBox.classList.remove("hidden");

  const formData = new FormData();
  formData.append("image", imageInput.files[0]);
  formData.append("latitude", document.getElementById("latitude").value);
  formData.append("longitude", "0"); // backend safe dummy
  formData.append("pincode", document.getElementById("pincode").value);
  formData.append("street", document.getElementById("street").value);
  formData.append("ward", document.getElementById("ward").value);
  formData.append("priority", document.getElementById("priority").value);

  try {
    const res = await fetch("http://localhost:5000/api/issues/create", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    responseDiv.innerHTML = `‚úÖ Report Created<br>ID: <b>${data.id}</b>`;
  } catch (err) {
    responseDiv.innerText = "‚ùå Error submitting report";
  }
});
</script>

</body>
</html>